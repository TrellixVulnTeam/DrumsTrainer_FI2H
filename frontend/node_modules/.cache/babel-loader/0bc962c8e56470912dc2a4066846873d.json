{"ast":null,"code":"//    abc_triplet_element.js: Definition of the TripletElem class.\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\nvar sprintf = require('./sprintf');\n\nvar TripletElem;\n\n(function () {\n  \"use strict\";\n\n  TripletElem = function TripletElem(number, anchor1, options) {\n    this.anchor1 = anchor1; // must have a .x and a .parent property or be null (means starts at the \"beginning\" of the line - after key signature)\n\n    this.number = number;\n    this.duration = ('' + anchor1.parent.durationClass).replace(/\\./, '-');\n    this.middleElems = []; // This is to calculate the highest interior pitch. It is used to make sure that the drawn bracket never crosses a really high middle note.\n\n    this.flatBeams = options.flatBeams;\n  };\n\n  TripletElem.prototype.isClosed = function () {\n    return this.anchor2;\n  };\n\n  TripletElem.prototype.middleNote = function (elem) {\n    this.middleElems.push(elem);\n  };\n\n  TripletElem.prototype.setCloseAnchor = function (anchor2) {\n    this.anchor2 = anchor2; // TODO-PER: Unfortunately, I don't know if there is a beam above until after the vertical positioning is done,\n    // so I don't know whether to leave room for the number above. Therefore, If there is a beam on the first note, I'll leave room just in case.\n\n    if (this.anchor1.parent.beam) this.endingHeightAbove = 4;\n  };\n\n  TripletElem.prototype.setUpperAndLowerElements = function ()\n  /*positionY*/\n  {};\n\n  TripletElem.prototype.layout = function () {\n    // TODO end and beginning of line (PER: P.S. I'm not sure this can happen: I think the parser will always specify both the start and end points.)\n    if (this.anchor1 && this.anchor2) {\n      this.hasBeam = this.anchor1.parent.beam && this.anchor1.parent.beam === this.anchor2.parent.beam;\n\n      if (this.hasBeam) {\n        // If there is a beam then we don't need to draw anything except the text. The beam could either be above or below.\n        var beam = this.anchor1.parent.beam;\n        var left = beam.isAbove() ? this.anchor1.x + this.anchor1.w : this.anchor1.x;\n        this.yTextPos = beam.heightAtMidpoint(left, this.anchor2.x);\n        this.yTextPos += beam.isAbove() ? 3 : -2; // This creates some space between the beam and the number.\n\n        this.top = this.yTextPos + 1;\n        this.bottom = this.yTextPos - 2;\n        if (beam.isAbove()) this.endingHeightAbove = 4;\n      } else {\n        // If there isn't a beam, then we need to draw the bracket and the text. The bracket is always above.\n        // The bracket is never lower than the 'a' line, but is 4 pitches above the first and last notes. If there is\n        // a tall note in the middle, the bracket is horizontal and above the highest note.\n        this.startNote = Math.max(this.anchor1.parent.top, 9) + 4;\n        this.endNote = Math.max(this.anchor2.parent.top, 9) + 4; // If it starts or ends on a rest, make the beam horizontal\n\n        if (this.anchor1.parent.type === \"rest\" && this.anchor2.parent.type !== \"rest\") this.startNote = this.endNote;else if (this.anchor2.parent.type === \"rest\" && this.anchor1.parent.type !== \"rest\") this.endNote = this.startNote; // See if the middle note is really high.\n\n        var max = 0;\n\n        for (var i = 0; i < this.middleElems.length; i++) {\n          max = Math.max(max, this.middleElems[i].top);\n        }\n\n        max += 4;\n\n        if (max > this.startNote || max > this.endNote) {\n          this.startNote = max;\n          this.endNote = max;\n        }\n\n        if (this.flatBeams) {\n          this.startNote = Math.max(this.startNote, this.endNote);\n          this.endNote = Math.max(this.startNote, this.endNote);\n        }\n\n        this.yTextPos = this.startNote + (this.endNote - this.startNote) / 2;\n        this.top = this.yTextPos + 1;\n      }\n    }\n\n    delete this.middleElems;\n    delete this.flatBeams;\n  };\n\n  TripletElem.prototype.draw = function (renderer) {\n    var xTextPos;\n\n    if (this.hasBeam) {\n      var left = this.anchor1.parent.beam.isAbove() ? this.anchor1.x + this.anchor1.w : this.anchor1.x;\n      xTextPos = this.anchor1.parent.beam.xAtMidpoint(left, this.anchor2.x);\n    } else {\n      xTextPos = this.anchor1.x + (this.anchor2.x + this.anchor2.w - this.anchor1.x) / 2;\n      drawBracket(renderer, this.anchor1.x, this.startNote, this.anchor2.x + this.anchor2.w, this.endNote, this.duration);\n    }\n\n    renderer.renderText(xTextPos, renderer.calcY(this.yTextPos), \"\" + this.number, 'tripletfont', renderer.addClasses('triplet d' + this.duration), \"middle\", true);\n  };\n\n  function drawLine(renderer, l, t, r, b, duration) {\n    var pathString = sprintf(\"M %f %f L %f %f\", l, t, r, b);\n    renderer.printPath({\n      path: pathString,\n      stroke: \"#000000\",\n      'class': renderer.addClasses('triplet d' + duration)\n    });\n  }\n\n  function drawBracket(renderer, x1, y1, x2, y2, duration) {\n    y1 = renderer.calcY(y1);\n    y2 = renderer.calcY(y2);\n    var bracketHeight = 5; // Draw vertical lines at the beginning and end\n\n    drawLine(renderer, x1, y1, x1, y1 + bracketHeight, duration);\n    drawLine(renderer, x2, y2, x2, y2 + bracketHeight, duration); // figure out midpoints to draw the broken line.\n\n    var midX = x1 + (x2 - x1) / 2; //var midY = y1 + (y2-y1)/2;\n\n    var gapWidth = 8;\n    var slope = (y2 - y1) / (x2 - x1);\n    var leftEndX = midX - gapWidth;\n    var leftEndY = y1 + (leftEndX - x1) * slope;\n    drawLine(renderer, x1, y1, leftEndX, leftEndY, duration);\n    var rightStartX = midX + gapWidth;\n    var rightStartY = y1 + (rightStartX - x1) * slope;\n    drawLine(renderer, rightStartX, rightStartY, x2, y2, duration);\n  }\n})();\n\nmodule.exports = TripletElem;","map":{"version":3,"sources":["/home/elad/Desktop/Repos/drums-trainer/frontend/node_modules/react-sheet-music/node_modules/abcjs/src/write/abc_triplet_element.js"],"names":["sprintf","require","TripletElem","number","anchor1","options","duration","parent","durationClass","replace","middleElems","flatBeams","prototype","isClosed","anchor2","middleNote","elem","push","setCloseAnchor","beam","endingHeightAbove","setUpperAndLowerElements","layout","hasBeam","left","isAbove","x","w","yTextPos","heightAtMidpoint","top","bottom","startNote","Math","max","endNote","type","i","length","draw","renderer","xTextPos","xAtMidpoint","drawBracket","renderText","calcY","addClasses","drawLine","l","t","r","b","pathString","printPath","path","stroke","x1","y1","x2","y2","bracketHeight","midX","gapWidth","slope","leftEndX","leftEndY","rightStartX","rightStartY","module","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,WAAD,CAArB;;AAEA,IAAIC,WAAJ;;AAEA,CAAC,YAAW;AACX;;AAEAA,EAAAA,WAAW,GAAG,SAASA,WAAT,CAAqBC,MAArB,EAA6BC,OAA7B,EAAsCC,OAAtC,EAA+C;AAC5D,SAAKD,OAAL,GAAeA,OAAf,CAD4D,CACpC;;AACxB,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKG,QAAL,GAAgB,CAAC,KAAGF,OAAO,CAACG,MAAR,CAAeC,aAAnB,EAAkCC,OAAlC,CAA0C,IAA1C,EAAgD,GAAhD,CAAhB;AACA,SAAKC,WAAL,GAAmB,EAAnB,CAJ4D,CAIrC;;AACvB,SAAKC,SAAL,GAAiBN,OAAO,CAACM,SAAzB;AACA,GAND;;AAQAT,EAAAA,WAAW,CAACU,SAAZ,CAAsBC,QAAtB,GAAiC,YAAW;AAC3C,WAAO,KAAKC,OAAZ;AACA,GAFD;;AAIAZ,EAAAA,WAAW,CAACU,SAAZ,CAAsBG,UAAtB,GAAmC,UAASC,IAAT,EAAe;AACjD,SAAKN,WAAL,CAAiBO,IAAjB,CAAsBD,IAAtB;AACA,GAFD;;AAIAd,EAAAA,WAAW,CAACU,SAAZ,CAAsBM,cAAtB,GAAuC,UAASJ,OAAT,EAAkB;AACxD,SAAKA,OAAL,GAAeA,OAAf,CADwD,CAExD;AACA;;AACA,QAAI,KAAKV,OAAL,CAAaG,MAAb,CAAoBY,IAAxB,EACC,KAAKC,iBAAL,GAAyB,CAAzB;AACD,GAND;;AAQAlB,EAAAA,WAAW,CAACU,SAAZ,CAAsBS,wBAAtB,GAAiD;AAAS;AAAe,GACxE,CADD;;AAGAnB,EAAAA,WAAW,CAACU,SAAZ,CAAsBU,MAAtB,GAA+B,YAAW;AACzC;AACA,QAAI,KAAKlB,OAAL,IAAgB,KAAKU,OAAzB,EAAkC;AACjC,WAAKS,OAAL,GAAe,KAAKnB,OAAL,CAAaG,MAAb,CAAoBY,IAApB,IAA4B,KAAKf,OAAL,CAAaG,MAAb,CAAoBY,IAApB,KAA6B,KAAKL,OAAL,CAAaP,MAAb,CAAoBY,IAA5F;;AAEA,UAAI,KAAKI,OAAT,EAAkB;AACjB;AACA,YAAIJ,IAAI,GAAG,KAAKf,OAAL,CAAaG,MAAb,CAAoBY,IAA/B;AACA,YAAIK,IAAI,GAAGL,IAAI,CAACM,OAAL,KAAiB,KAAKrB,OAAL,CAAasB,CAAb,GAAiB,KAAKtB,OAAL,CAAauB,CAA/C,GAAmD,KAAKvB,OAAL,CAAasB,CAA3E;AACA,aAAKE,QAAL,GAAgBT,IAAI,CAACU,gBAAL,CAAsBL,IAAtB,EAA6B,KAAKV,OAAL,CAAaY,CAA1C,CAAhB;AACA,aAAKE,QAAL,IAAiBT,IAAI,CAACM,OAAL,KAAiB,CAAjB,GAAqB,CAAC,CAAvC,CALiB,CAKyB;;AAC1C,aAAKK,GAAL,GAAW,KAAKF,QAAL,GAAgB,CAA3B;AACA,aAAKG,MAAL,GAAc,KAAKH,QAAL,GAAgB,CAA9B;AACA,YAAIT,IAAI,CAACM,OAAL,EAAJ,EACC,KAAKL,iBAAL,GAAyB,CAAzB;AACD,OAVD,MAUO;AACN;AACA;AACA;AACA,aAAKY,SAAL,GAAiBC,IAAI,CAACC,GAAL,CAAS,KAAK9B,OAAL,CAAaG,MAAb,CAAoBuB,GAA7B,EAAkC,CAAlC,IAAuC,CAAxD;AACA,aAAKK,OAAL,GAAeF,IAAI,CAACC,GAAL,CAAS,KAAKpB,OAAL,CAAaP,MAAb,CAAoBuB,GAA7B,EAAkC,CAAlC,IAAuC,CAAtD,CALM,CAMN;;AACA,YAAI,KAAK1B,OAAL,CAAaG,MAAb,CAAoB6B,IAApB,KAA6B,MAA7B,IAAuC,KAAKtB,OAAL,CAAaP,MAAb,CAAoB6B,IAApB,KAA6B,MAAxE,EACC,KAAKJ,SAAL,GAAiB,KAAKG,OAAtB,CADD,KAEK,IAAI,KAAKrB,OAAL,CAAaP,MAAb,CAAoB6B,IAApB,KAA6B,MAA7B,IAAuC,KAAKhC,OAAL,CAAaG,MAAb,CAAoB6B,IAApB,KAA6B,MAAxE,EACJ,KAAKD,OAAL,GAAe,KAAKH,SAApB,CAVK,CAWN;;AACA,YAAIE,GAAG,GAAG,CAAV;;AACA,aAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK3B,WAAL,CAAiB4B,MAArC,EAA6CD,CAAC,EAA9C,EAAkD;AACjDH,UAAAA,GAAG,GAAGD,IAAI,CAACC,GAAL,CAASA,GAAT,EAAc,KAAKxB,WAAL,CAAiB2B,CAAjB,EAAoBP,GAAlC,CAAN;AACA;;AACDI,QAAAA,GAAG,IAAI,CAAP;;AACA,YAAIA,GAAG,GAAG,KAAKF,SAAX,IAAwBE,GAAG,GAAG,KAAKC,OAAvC,EAAgD;AAC/C,eAAKH,SAAL,GAAiBE,GAAjB;AACA,eAAKC,OAAL,GAAeD,GAAf;AACA;;AACD,YAAI,KAAKvB,SAAT,EAAoB;AACnB,eAAKqB,SAAL,GAAiBC,IAAI,CAACC,GAAL,CAAS,KAAKF,SAAd,EAAyB,KAAKG,OAA9B,CAAjB;AACA,eAAKA,OAAL,GAAeF,IAAI,CAACC,GAAL,CAAS,KAAKF,SAAd,EAAyB,KAAKG,OAA9B,CAAf;AACA;;AAED,aAAKP,QAAL,GAAgB,KAAKI,SAAL,GAAiB,CAAC,KAAKG,OAAL,GAAe,KAAKH,SAArB,IAAkC,CAAnE;AACA,aAAKF,GAAL,GAAW,KAAKF,QAAL,GAAgB,CAA3B;AACA;AACD;;AACD,WAAO,KAAKlB,WAAZ;AACA,WAAO,KAAKC,SAAZ;AACA,GA/CD;;AAiDAT,EAAAA,WAAW,CAACU,SAAZ,CAAsB2B,IAAtB,GAA6B,UAASC,QAAT,EAAmB;AAC/C,QAAIC,QAAJ;;AACA,QAAI,KAAKlB,OAAT,EAAkB;AACjB,UAAIC,IAAI,GAAG,KAAKpB,OAAL,CAAaG,MAAb,CAAoBY,IAApB,CAAyBM,OAAzB,KAAqC,KAAKrB,OAAL,CAAasB,CAAb,GAAiB,KAAKtB,OAAL,CAAauB,CAAnE,GAAuE,KAAKvB,OAAL,CAAasB,CAA/F;AACAe,MAAAA,QAAQ,GAAG,KAAKrC,OAAL,CAAaG,MAAb,CAAoBY,IAApB,CAAyBuB,WAAzB,CAAqClB,IAArC,EAA2C,KAAKV,OAAL,CAAaY,CAAxD,CAAX;AACA,KAHD,MAGO;AACNe,MAAAA,QAAQ,GAAG,KAAKrC,OAAL,CAAasB,CAAb,GAAiB,CAAC,KAAKZ,OAAL,CAAaY,CAAb,GAAiB,KAAKZ,OAAL,CAAaa,CAA9B,GAAkC,KAAKvB,OAAL,CAAasB,CAAhD,IAAqD,CAAjF;AACAiB,MAAAA,WAAW,CAACH,QAAD,EAAW,KAAKpC,OAAL,CAAasB,CAAxB,EAA2B,KAAKM,SAAhC,EAA2C,KAAKlB,OAAL,CAAaY,CAAb,GAAiB,KAAKZ,OAAL,CAAaa,CAAzE,EAA4E,KAAKQ,OAAjF,EAA0F,KAAK7B,QAA/F,CAAX;AACA;;AACDkC,IAAAA,QAAQ,CAACI,UAAT,CAAoBH,QAApB,EAA8BD,QAAQ,CAACK,KAAT,CAAe,KAAKjB,QAApB,CAA9B,EAA6D,KAAK,KAAKzB,MAAvE,EAA+E,aAA/E,EAA8FqC,QAAQ,CAACM,UAAT,CAAoB,cAAY,KAAKxC,QAArC,CAA9F,EAA8I,QAA9I,EAAwJ,IAAxJ;AACA,GAVD;;AAYA,WAASyC,QAAT,CAAkBP,QAAlB,EAA4BQ,CAA5B,EAA+BC,CAA/B,EAAkCC,CAAlC,EAAqCC,CAArC,EAAwC7C,QAAxC,EAAkD;AACjD,QAAI8C,UAAU,GAAGpD,OAAO,CAAC,iBAAD,EACvBgD,CADuB,EACpBC,CADoB,EACjBC,CADiB,EACdC,CADc,CAAxB;AAEAX,IAAAA,QAAQ,CAACa,SAAT,CAAmB;AAACC,MAAAA,IAAI,EAAEF,UAAP;AAAmBG,MAAAA,MAAM,EAAE,SAA3B;AAAsC,eAASf,QAAQ,CAACM,UAAT,CAAoB,cAAYxC,QAAhC;AAA/C,KAAnB;AACA;;AAED,WAASqC,WAAT,CAAqBH,QAArB,EAA+BgB,EAA/B,EAAmCC,EAAnC,EAAuCC,EAAvC,EAA2CC,EAA3C,EAA+CrD,QAA/C,EAAyD;AACxDmD,IAAAA,EAAE,GAAGjB,QAAQ,CAACK,KAAT,CAAeY,EAAf,CAAL;AACAE,IAAAA,EAAE,GAAGnB,QAAQ,CAACK,KAAT,CAAec,EAAf,CAAL;AACA,QAAIC,aAAa,GAAG,CAApB,CAHwD,CAKxD;;AACAb,IAAAA,QAAQ,CAACP,QAAD,EAAWgB,EAAX,EAAeC,EAAf,EAAmBD,EAAnB,EAAuBC,EAAE,GAAGG,aAA5B,EAA2CtD,QAA3C,CAAR;AACAyC,IAAAA,QAAQ,CAACP,QAAD,EAAWkB,EAAX,EAAeC,EAAf,EAAmBD,EAAnB,EAAuBC,EAAE,GAAGC,aAA5B,EAA2CtD,QAA3C,CAAR,CAPwD,CASxD;;AACA,QAAIuD,IAAI,GAAGL,EAAE,GAAG,CAACE,EAAE,GAACF,EAAJ,IAAQ,CAAxB,CAVwD,CAWxD;;AACA,QAAIM,QAAQ,GAAG,CAAf;AACA,QAAIC,KAAK,GAAG,CAACJ,EAAE,GAAGF,EAAN,KAAaC,EAAE,GAAGF,EAAlB,CAAZ;AACA,QAAIQ,QAAQ,GAAGH,IAAI,GAAGC,QAAtB;AACA,QAAIG,QAAQ,GAAGR,EAAE,GAAG,CAACO,QAAQ,GAAGR,EAAZ,IAAkBO,KAAtC;AACAhB,IAAAA,QAAQ,CAACP,QAAD,EAAWgB,EAAX,EAAeC,EAAf,EAAmBO,QAAnB,EAA6BC,QAA7B,EAAuC3D,QAAvC,CAAR;AACA,QAAI4D,WAAW,GAAGL,IAAI,GAAGC,QAAzB;AACA,QAAIK,WAAW,GAAGV,EAAE,GAAG,CAACS,WAAW,GAAGV,EAAf,IAAqBO,KAA5C;AACAhB,IAAAA,QAAQ,CAACP,QAAD,EAAW0B,WAAX,EAAwBC,WAAxB,EAAqCT,EAArC,EAAyCC,EAAzC,EAA6CrD,QAA7C,CAAR;AACA;AACD,CAtHD;;AAwHA8D,MAAM,CAACC,OAAP,GAAiBnE,WAAjB","sourcesContent":["//    abc_triplet_element.js: Definition of the TripletElem class.\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar sprintf = require('./sprintf');\n\nvar TripletElem;\n\n(function() {\n\t\"use strict\";\n\n\tTripletElem = function TripletElem(number, anchor1, options) {\n\t\tthis.anchor1 = anchor1; // must have a .x and a .parent property or be null (means starts at the \"beginning\" of the line - after key signature)\n\t\tthis.number = number;\n\t\tthis.duration = (''+anchor1.parent.durationClass).replace(/\\./, '-');\n\t\tthis.middleElems = []; // This is to calculate the highest interior pitch. It is used to make sure that the drawn bracket never crosses a really high middle note.\n\t\tthis.flatBeams = options.flatBeams;\n\t};\n\n\tTripletElem.prototype.isClosed = function() {\n\t\treturn this.anchor2;\n\t};\n\n\tTripletElem.prototype.middleNote = function(elem) {\n\t\tthis.middleElems.push(elem);\n\t};\n\n\tTripletElem.prototype.setCloseAnchor = function(anchor2) {\n\t\tthis.anchor2 = anchor2;\n\t\t// TODO-PER: Unfortunately, I don't know if there is a beam above until after the vertical positioning is done,\n\t\t// so I don't know whether to leave room for the number above. Therefore, If there is a beam on the first note, I'll leave room just in case.\n\t\tif (this.anchor1.parent.beam)\n\t\t\tthis.endingHeightAbove = 4;\n\t};\n\n\tTripletElem.prototype.setUpperAndLowerElements = function(/*positionY*/) {\n\t};\n\n\tTripletElem.prototype.layout = function() {\n\t\t// TODO end and beginning of line (PER: P.S. I'm not sure this can happen: I think the parser will always specify both the start and end points.)\n\t\tif (this.anchor1 && this.anchor2) {\n\t\t\tthis.hasBeam = this.anchor1.parent.beam && this.anchor1.parent.beam === this.anchor2.parent.beam;\n\n\t\t\tif (this.hasBeam) {\n\t\t\t\t// If there is a beam then we don't need to draw anything except the text. The beam could either be above or below.\n\t\t\t\tvar beam = this.anchor1.parent.beam;\n\t\t\t\tvar left = beam.isAbove() ? this.anchor1.x + this.anchor1.w : this.anchor1.x;\n\t\t\t\tthis.yTextPos = beam.heightAtMidpoint(left,  this.anchor2.x);\n\t\t\t\tthis.yTextPos += beam.isAbove() ? 3 : -2; // This creates some space between the beam and the number.\n\t\t\t\tthis.top = this.yTextPos + 1;\n\t\t\t\tthis.bottom = this.yTextPos - 2;\n\t\t\t\tif (beam.isAbove())\n\t\t\t\t\tthis.endingHeightAbove = 4;\n\t\t\t} else {\n\t\t\t\t// If there isn't a beam, then we need to draw the bracket and the text. The bracket is always above.\n\t\t\t\t// The bracket is never lower than the 'a' line, but is 4 pitches above the first and last notes. If there is\n\t\t\t\t// a tall note in the middle, the bracket is horizontal and above the highest note.\n\t\t\t\tthis.startNote = Math.max(this.anchor1.parent.top, 9) + 4;\n\t\t\t\tthis.endNote = Math.max(this.anchor2.parent.top, 9) + 4;\n\t\t\t\t// If it starts or ends on a rest, make the beam horizontal\n\t\t\t\tif (this.anchor1.parent.type === \"rest\" && this.anchor2.parent.type !== \"rest\")\n\t\t\t\t\tthis.startNote = this.endNote;\n\t\t\t\telse if (this.anchor2.parent.type === \"rest\" && this.anchor1.parent.type !== \"rest\")\n\t\t\t\t\tthis.endNote = this.startNote;\n\t\t\t\t// See if the middle note is really high.\n\t\t\t\tvar max = 0;\n\t\t\t\tfor (var i = 0; i < this.middleElems.length; i++) {\n\t\t\t\t\tmax = Math.max(max, this.middleElems[i].top);\n\t\t\t\t}\n\t\t\t\tmax += 4;\n\t\t\t\tif (max > this.startNote || max > this.endNote) {\n\t\t\t\t\tthis.startNote = max;\n\t\t\t\t\tthis.endNote = max;\n\t\t\t\t}\n\t\t\t\tif (this.flatBeams) {\n\t\t\t\t\tthis.startNote = Math.max(this.startNote, this.endNote);\n\t\t\t\t\tthis.endNote = Math.max(this.startNote, this.endNote);\n\t\t\t\t}\n\n\t\t\t\tthis.yTextPos = this.startNote + (this.endNote - this.startNote) / 2;\n\t\t\t\tthis.top = this.yTextPos + 1;\n\t\t\t}\n\t\t}\n\t\tdelete this.middleElems;\n\t\tdelete this.flatBeams;\n\t};\n\n\tTripletElem.prototype.draw = function(renderer) {\n\t\tvar xTextPos;\n\t\tif (this.hasBeam) {\n\t\t\tvar left = this.anchor1.parent.beam.isAbove() ? this.anchor1.x + this.anchor1.w : this.anchor1.x;\n\t\t\txTextPos = this.anchor1.parent.beam.xAtMidpoint(left, this.anchor2.x);\n\t\t} else {\n\t\t\txTextPos = this.anchor1.x + (this.anchor2.x + this.anchor2.w - this.anchor1.x) / 2;\n\t\t\tdrawBracket(renderer, this.anchor1.x, this.startNote, this.anchor2.x + this.anchor2.w, this.endNote, this.duration);\n\t\t}\n\t\trenderer.renderText(xTextPos, renderer.calcY(this.yTextPos), \"\" + this.number, 'tripletfont', renderer.addClasses('triplet d'+this.duration), \"middle\", true);\n\t};\n\n\tfunction drawLine(renderer, l, t, r, b, duration) {\n\t\tvar pathString = sprintf(\"M %f %f L %f %f\",\n\t\t\tl, t, r, b);\n\t\trenderer.printPath({path: pathString, stroke: \"#000000\", 'class': renderer.addClasses('triplet d'+duration)});\n\t}\n\n\tfunction drawBracket(renderer, x1, y1, x2, y2, duration) {\n\t\ty1 = renderer.calcY(y1);\n\t\ty2 = renderer.calcY(y2);\n\t\tvar bracketHeight = 5;\n\n\t\t// Draw vertical lines at the beginning and end\n\t\tdrawLine(renderer, x1, y1, x1, y1 + bracketHeight, duration);\n\t\tdrawLine(renderer, x2, y2, x2, y2 + bracketHeight, duration);\n\n\t\t// figure out midpoints to draw the broken line.\n\t\tvar midX = x1 + (x2-x1)/2;\n\t\t//var midY = y1 + (y2-y1)/2;\n\t\tvar gapWidth = 8;\n\t\tvar slope = (y2 - y1) / (x2 - x1);\n\t\tvar leftEndX = midX - gapWidth;\n\t\tvar leftEndY = y1 + (leftEndX - x1) * slope;\n\t\tdrawLine(renderer, x1, y1, leftEndX, leftEndY, duration);\n\t\tvar rightStartX = midX + gapWidth;\n\t\tvar rightStartY = y1 + (rightStartX - x1) * slope;\n\t\tdrawLine(renderer, rightStartX, rightStartY, x2, y2, duration);\n\t}\n})();\n\nmodule.exports = TripletElem;\n"]},"metadata":{},"sourceType":"script"}