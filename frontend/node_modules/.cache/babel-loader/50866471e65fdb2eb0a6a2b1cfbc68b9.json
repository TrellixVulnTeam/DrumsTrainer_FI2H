{"ast":null,"code":"//    abc_tempo_element.js: Definition of the TempoElement class.\n//    Copyright (C) 2014-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\nvar AbsoluteElement = require('./abc_absolute_element');\n\nvar RelativeElement = require('./abc_relative_element');\n\nvar TempoElement;\n\n(function () {\n  \"use strict\";\n\n  var totalHeightInPitches = 5;\n\n  TempoElement = function TempoElement(tempo, tuneNumber, createNoteHead) {\n    this.tempo = tempo;\n    this.tuneNumber = tuneNumber;\n    this.tempoHeightAbove = totalHeightInPitches;\n    this.pitch = undefined; // This will be set later\n\n    if (this.tempo.duration && !this.tempo.suppressBpm) {\n      this.note = this.createNote(createNoteHead, tempo, tuneNumber);\n    }\n  };\n\n  TempoElement.prototype.setUpperAndLowerElements = function (positionY) {\n    // TODO-PER: This might not be called.\n    this.pitch = positionY.tempoHeightAbove;\n    this.top = positionY.tempoHeightAbove;\n    this.bottom = positionY.tempoHeightAbove;\n\n    if (this.note) {\n      var tempoPitch = this.pitch - totalHeightInPitches + 1; // The pitch we receive is the top of the allotted area: change that to practically the bottom.\n\n      this.note.top = tempoPitch;\n      this.note.bottom = tempoPitch;\n\n      for (var i = 0; i < this.note.children.length; i++) {\n        var child = this.note.children[i];\n        child.top += tempoPitch;\n        child.bottom += tempoPitch;\n        child.pitch += tempoPitch;\n        if (child.pitch2 !== undefined) child.pitch2 += tempoPitch;\n      }\n    }\n  };\n\n  TempoElement.prototype.setX = function (x) {\n    this.x = x;\n  };\n\n  TempoElement.prototype.createNote = function (createNoteHead, tempo, tuneNumber) {\n    var temposcale = 0.75;\n    var duration = tempo.duration[0]; // TODO when multiple durations\n\n    var absElem = new AbsoluteElement(tempo, duration, 1, 'tempo', tuneNumber); // There aren't an infinite number of note values, but we are passed a float, so just in case something is off upstream,\n    // merge all of the in between points.\n\n    var dot;\n    var flag;\n    var note;\n\n    if (duration <= 1 / 32) {\n      note = \"noteheads.quarter\";\n      flag = \"flags.u32nd\";\n      dot = 0;\n    } else if (duration <= 1 / 16) {\n      note = \"noteheads.quarter\";\n      flag = \"flags.u16th\";\n      dot = 0;\n    } else if (duration <= 3 / 32) {\n      note = \"noteheads.quarter\";\n      flag = \"flags.u16nd\";\n      dot = 1;\n    } else if (duration <= 1 / 8) {\n      note = \"noteheads.quarter\";\n      flag = \"flags.u8th\";\n      dot = 0;\n    } else if (duration <= 3 / 16) {\n      note = \"noteheads.quarter\";\n      flag = \"flags.u8th\";\n      dot = 1;\n    } else if (duration <= 1 / 4) {\n      note = \"noteheads.quarter\";\n      dot = 0;\n    } else if (duration <= 3 / 8) {\n      note = \"noteheads.quarter\";\n      dot = 1;\n    } else if (duration <= 1 / 2) {\n      note = \"noteheads.half\";\n      dot = 0;\n    } else if (duration <= 3 / 4) {\n      note = \"noteheads.half\";\n      dot = 1;\n    } else if (duration <= 1) {\n      note = \"noteheads.whole\";\n      dot = 0;\n    } else if (duration <= 1.5) {\n      note = \"noteheads.whole\";\n      dot = 1;\n    } else if (duration <= 2) {\n      note = \"noteheads.dbl\";\n      dot = 0;\n    } else {\n      note = \"noteheads.dbl\";\n      dot = 1;\n    }\n\n    var ret = createNoteHead(absElem, note, {\n      verticalPos: 0\n    }, // This is just temporary: we'll offset the vertical positioning when we get the actual vertical spot.\n    \"up\", 0, 0, flag, dot, 0, temposcale, [], false);\n    var tempoNote = ret.notehead;\n    absElem.addHead(tempoNote);\n    var stem;\n\n    if (note !== \"noteheads.whole\" && note !== \"noteheads.dbl\") {\n      var p1 = 1 / 3 * temposcale;\n      var p2 = 7 * temposcale;\n      var dx = tempoNote.dx + tempoNote.w;\n      var width = -0.6;\n      stem = new RelativeElement(null, dx, 0, p1, {\n        \"type\": \"stem\",\n        \"pitch2\": p2,\n        linewidth: width\n      });\n      absElem.addExtra(stem);\n    }\n\n    return absElem;\n  };\n\n  TempoElement.prototype.draw = function (renderer) {\n    var x = this.x;\n    if (this.pitch === undefined) window.console.error(\"Tempo Element y-coordinate not set.\");\n    var y = renderer.calcY(this.pitch);\n    var text;\n\n    if (this.tempo.preString) {\n      text = renderer.renderText(x, y, this.tempo.preString, 'tempofont', 'tempo', \"start\");\n      var size = renderer.getTextSize(this.tempo.preString, 'tempofont', 'tempo', text);\n      var preWidth = size.width;\n      var charWidth = preWidth / this.tempo.preString.length; // Just get some average number to increase the spacing.\n\n      x += preWidth + charWidth;\n    }\n\n    if (this.note) {\n      if (this.note) this.note.setX(x);\n\n      for (var i = 0; i < this.note.children.length; i++) this.note.children[i].draw(renderer, x);\n\n      x += this.note.w + 5;\n      var str = \"= \" + this.tempo.bpm;\n      text = renderer.renderText(x, y, str, 'tempofont', 'tempo', \"start\");\n      size = renderer.getTextSize(str, 'tempofont', 'tempo', text);\n      var postWidth = size.width;\n      var charWidth2 = postWidth / str.length; // Just get some average number to increase the spacing.\n\n      x += postWidth + charWidth2;\n    }\n\n    if (this.tempo.postString) {\n      renderer.renderText(x, y, this.tempo.postString, 'tempofont', 'tempo', \"start\");\n    }\n  };\n})();\n\nmodule.exports = TempoElement;","map":{"version":3,"sources":["/home/elad/Desktop/Repos/drums-trainer/frontend/node_modules/react-sheet-music/node_modules/abcjs/src/write/abc_tempo_element.js"],"names":["AbsoluteElement","require","RelativeElement","TempoElement","totalHeightInPitches","tempo","tuneNumber","createNoteHead","tempoHeightAbove","pitch","undefined","duration","suppressBpm","note","createNote","prototype","setUpperAndLowerElements","positionY","top","bottom","tempoPitch","i","children","length","child","pitch2","setX","x","temposcale","absElem","dot","flag","ret","verticalPos","tempoNote","notehead","addHead","stem","p1","p2","dx","w","width","linewidth","addExtra","draw","renderer","window","console","error","y","calcY","text","preString","renderText","size","getTextSize","preWidth","charWidth","str","bpm","postWidth","charWidth2","postString","module","exports"],"mappings":"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","sourcesContent":["//    abc_tempo_element.js: Definition of the TempoElement class.\n//    Copyright (C) 2014-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar AbsoluteElement = require('./abc_absolute_element');\nvar RelativeElement = require('./abc_relative_element');\n\nvar TempoElement;\n(function() {\n\t\"use strict\";\n\tvar totalHeightInPitches = 5;\n\n\tTempoElement = function TempoElement(tempo, tuneNumber, createNoteHead) {\n\t\tthis.tempo = tempo;\n\t\tthis.tuneNumber = tuneNumber;\n\t\tthis.tempoHeightAbove = totalHeightInPitches;\n\t\tthis.pitch = undefined; // This will be set later\n\t\tif (this.tempo.duration && !this.tempo.suppressBpm) {\n\t\t\tthis.note = this.createNote(createNoteHead, tempo, tuneNumber);\n\t\t}\n\t};\n\n\tTempoElement.prototype.setUpperAndLowerElements = function(positionY) { // TODO-PER: This might not be called.\n\t\tthis.pitch = positionY.tempoHeightAbove;\n\t\tthis.top = positionY.tempoHeightAbove;\n\t\tthis.bottom = positionY.tempoHeightAbove;\n\t\tif (this.note) {\n\t\t\tvar tempoPitch = this.pitch - totalHeightInPitches + 1; // The pitch we receive is the top of the allotted area: change that to practically the bottom.\n\t\t\tthis.note.top = tempoPitch;\n\t\t\tthis.note.bottom = tempoPitch;\n\t\t\tfor (var i = 0; i < this.note.children.length; i++) {\n\t\t\t\tvar child = this.note.children[i];\n\t\t\t\tchild.top += tempoPitch;\n\t\t\t\tchild.bottom += tempoPitch;\n\t\t\t\tchild.pitch += tempoPitch;\n\t\t\t\tif (child.pitch2 !== undefined)\n\t\t\t\t\tchild.pitch2 += tempoPitch;\n\t\t\t}\n\t\t}\n\t};\n\n\tTempoElement.prototype.setX = function (x) {\n\t\tthis.x = x;\n\t};\n\n\tTempoElement.prototype.createNote = function(createNoteHead, tempo, tuneNumber) {\n\t\tvar temposcale = 0.75;\n\t\tvar duration = tempo.duration[0]; // TODO when multiple durations\n\t\tvar absElem = new AbsoluteElement(tempo, duration, 1, 'tempo', tuneNumber);\n\t\t// There aren't an infinite number of note values, but we are passed a float, so just in case something is off upstream,\n\t\t// merge all of the in between points.\n\t\tvar dot;\n\t\tvar flag;\n\t\tvar note;\n\t\tif (duration <= 1/32) { note = \"noteheads.quarter\"; flag = \"flags.u32nd\"; dot = 0; }\n\t\telse if (duration <= 1/16) { note = \"noteheads.quarter\"; flag = \"flags.u16th\"; dot = 0; }\n\t\telse if (duration <= 3/32) { note = \"noteheads.quarter\"; flag = \"flags.u16nd\"; dot = 1; }\n\t\telse if (duration <= 1/8) { note = \"noteheads.quarter\"; flag = \"flags.u8th\"; dot = 0; }\n\t\telse if (duration <= 3/16) { note = \"noteheads.quarter\"; flag = \"flags.u8th\"; dot = 1; }\n\t\telse if (duration <= 1/4) { note = \"noteheads.quarter\"; dot = 0; }\n\t\telse if (duration <= 3/8) { note = \"noteheads.quarter\"; dot = 1; }\n\t\telse if (duration <= 1/2) { note = \"noteheads.half\"; dot = 0; }\n\t\telse if (duration <= 3/4) { note = \"noteheads.half\"; dot = 1; }\n\t\telse if (duration <= 1) { note = \"noteheads.whole\"; dot = 0; }\n\t\telse if (duration <= 1.5) { note = \"noteheads.whole\"; dot = 1; }\n\t\telse if (duration <= 2) { note = \"noteheads.dbl\"; dot = 0; }\n\t\telse { note = \"noteheads.dbl\"; dot = 1; }\n\n\t\tvar ret = createNoteHead(absElem,\n\t\t\tnote,\n\t\t\t{ verticalPos: 0}, // This is just temporary: we'll offset the vertical positioning when we get the actual vertical spot.\n\t\t\t\"up\",\n\t\t\t0,\n\t\t\t0,\n\t\t\tflag,\n\t\t\tdot,\n\t\t\t0,\n\t\t\ttemposcale,\n\t\t\t[],\n\t\t\tfalse\n\t\t);\n\t\tvar tempoNote = ret.notehead;\n\t\tabsElem.addHead(tempoNote);\n\t\tvar stem;\n\t\tif (note !== \"noteheads.whole\" && note !== \"noteheads.dbl\") {\n\t\t\tvar p1 = 1 / 3 * temposcale;\n\t\t\tvar p2 = 7 * temposcale;\n\t\t\tvar dx = tempoNote.dx + tempoNote.w;\n\t\t\tvar width = -0.6;\n\t\t\tstem = new RelativeElement(null, dx, 0, p1, {\"type\": \"stem\", \"pitch2\": p2, linewidth: width});\n\t\t\tabsElem.addExtra(stem);\n\t\t}\n\t\treturn absElem;\n\t};\n\n\tTempoElement.prototype.draw = function(renderer) {\n\t\tvar x = this.x;\n\t\tif (this.pitch === undefined)\n\t\t\twindow.console.error(\"Tempo Element y-coordinate not set.\");\n\n\t\tvar y = renderer.calcY(this.pitch);\n\t\tvar text;\n\t\tif (this.tempo.preString) {\n\t\t\ttext = renderer.renderText(x, y, this.tempo.preString, 'tempofont', 'tempo', \"start\");\n\t\t\tvar size = renderer.getTextSize(this.tempo.preString, 'tempofont', 'tempo', text);\n\t\t\tvar preWidth = size.width;\n\t\t\tvar charWidth = preWidth / this.tempo.preString.length; // Just get some average number to increase the spacing.\n\t\t\tx += preWidth + charWidth;\n\t\t}\n\t\tif (this.note) {\n\t\t\tif (this.note)\n\t\t\t\tthis.note.setX(x);\n\t\t\tfor (var i = 0; i < this.note.children.length; i++)\n\t\t\t\tthis.note.children[i].draw(renderer, x);\n\t\t\tx += (this.note.w + 5);\n\t\t\tvar str = \"= \" + this.tempo.bpm;\n\t\t\ttext = renderer.renderText(x, y, str, 'tempofont', 'tempo', \"start\");\n\t\t\tsize = renderer.getTextSize(str, 'tempofont', 'tempo', text);\n\t\t\tvar postWidth = size.width;\n\t\t\tvar charWidth2 = postWidth / str.length; // Just get some average number to increase the spacing.\n\t\t\tx += postWidth + charWidth2;\n\t\t}\n\t\tif (this.tempo.postString) {\n\t\t\trenderer.renderText(x, y, this.tempo.postString, 'tempofont', 'tempo', \"start\");\n\t\t}\n\t};\n})();\n\nmodule.exports = TempoElement;\n"]},"metadata":{},"sourceType":"script"}